<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wearable technology for music performance - A hands-free talkbox</title>
  <meta name="description" content="Gesture recognition controls and a multi-touch configuration interface to make you feel like a rockstar">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
  <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="WorldQL">
  <link rel="alternate" href="/feed/feed.json" type="application/json" title="WorldQL">
</head>
<body>

<div class="welcome">
  <header>
    <div class="header-contents">
      <div class="home"><a href="/">WorldQL</a></div>
      <ul class="nav" style="display: flex; justify-content: center; flex-direction: column">
        <div>
            <li class="nav-item"><a
                href="/">Home</a></li>
            <li class="nav-item"><a
                href="/about/">About</a></li>
            <li class="nav-item"><a
                href="https://www.zachleat.com/">Community</a></li>
            <li class="nav-item"><a
                href="https://www.zachleat.com/">Docs</a></li>
        </div>
      </ul>
    </div>
  </header>

</div>

<main class="tmpl-post">
  
<h1>Wearable technology for music performance - A hands-free talkbox</h1>
Published Sunday, April 11, 2021
<h3 style="color: grey">Gesture recognition controls and a multi-touch configuration interface to make you feel like a rockstar</h3>

<div class="tmpl-post-contents">

<h2 id="motivation-and-concept">Motivation and Concept <a class="direct-link" href="#motivation-and-concept">#</a></h2>
<p>I have recently been interested in the talkbox, a musical instrument which allows the player to shape the sound of a sawtooth tone using their mouth. The instrument consists of a tone generator (usually a compression driver) which is attached to a piece of rubber tubing. The player places this tube inside their mouth and grips it with their back teeth. The talkbox is surprisingly easy to master; one can mouth words as they normally do and instantly enjoy a cool robotic singing voice.</p>
<div class="captionedimg">
<img src="/img/peter-frampton-show-me-the-way-1975--735x413.jpg">
Peter Frampton is often credited with popularizing the talkbox. His device used analogue tube amplifiers driven by an electric guitar to produce a distinctive and mesmerizing effect.
</div>
<p>I wanted to build an extremely accessible talkbox that met the following conditions:</p>
<ol>
<li>It should not require knowledge of any musical instruments, modern talkboxes require users to be proficient keyboardists or know how to play the guitar.</li>
<li>It must be controllable hands-free, leaving one's hands available for other things.</li>
<li>Ease of use is important, so the talkbox should be easy to configure and set up.</li>
</ol>
<p>To meet these requirements, I am creating a mobile talkbox which uses a bespoke app and Nintendo Switch joycons to enable gesture controls.</p>
<h2 id="materials">Materials <a class="direct-link" href="#materials">#</a></h2>
<p>To make my wearable hands-free talkbox, I used the following materials:</p>
<ul>
<li>Two Nintendo Switch Joycons (left and right)</li>
<li>6 ft. 1/3rd inch plastic tubing</li>
<li>Loctite Superglue (the best brand of super glue)</li>
<li>Stretchy latex gloves</li>
<li>Needle, thread, and fabric</li>
<li>A good pair of scissors</li>
<li>A smartphone</li>
</ul>
<div class="captionedimg">
<img src="/img/2021-04-12_03-19-18.jpg" style="max-height: 400px;"><br>
The basic materials
</div>
<p>Originally, I attempted to use my Arduino Uno device (cutting out the need for a smartphone), but found the HC-05 Bluetooth module I ordered was incapable of interfacing with Joycons due to their usage of Bluetooth 4 features ðŸ˜ž. This was an unfortunate setback; however, most people have smartphones already!</p>
<p>You'll also need a computer running Linux or macOS to (easily) use the libraries for capturing Joycon input. This article will only document installation instructions for Ubuntu 20.04 LTS.</p>
<h2 id="construction">Construction <a class="direct-link" href="#construction">#</a></h2>
<ol>
<li>
<p>Cut fingers off of latex glove.</p>
</li>
<li>
<p>Cut 10 inch tube from the spool, set aside.</p>
</li>
<li>
<p>Cut a small hole in the reverse end of the latex glove finger, insert plastic tubing.</p>
</li>
<li>
<p>Using Loctite super glue, securely attach the latex to the tube forming a weak seal.</p>
</li>
</ol>
<div class="captionedimg">
<img src="/img/2021-04-12_03-21-27.jpg" style="max-height: 300px"><br>
Your tube-glove finger attachment should look like this
</div>
<ol start="5">
<li>
<p>Stretch product over smartphone</p>
</li>
<li>
<p>Sew or attach pouch to outside of shirt to hold smartphone.</p>
</li>
</ol>
<div class="captionedimg">
<img src="/img/2021-04-12_03-25-18.jpg" style="max-height: 350px"><br>
The tone generator and attached tube in card stock pocket.
</div>
<ol start="7">
<li>Create wrist straps for the Joycons.</li>
</ol>
<div class="captionedimg">
<img src="/img/2021-04-19_03-13-57.jpg" style="max-height: 350px;">
</div>
<p>Now we've got everything physical we need to move on!</p>
<h2 id="programming-implementation">Programming implementation <a class="direct-link" href="#programming-implementation">#</a></h2>
<p>This project requires a variety of tools in multiple programming languages. First, we'll be creating a tone generator in JavaScript as well as a user interface to control it. This will allow us to test our concept prior to adding motion controls and lay the groundwork for the rest of the project. After that, we'll be writing a Bluetooth receiver in C++ using the HIDAPI which captures data from the Joycons and forwards instructions to the tone generator running on the smartphone.</p>
<h3 id="building-our-user-interface">Building our user interface <a class="direct-link" href="#building-our-user-interface">#</a></h3>
<p>First, let's create a grid of notes using CSS and HTML. First, we'll need to define a flexbox to contain our notes and distribute them evenly. Next, we need to create 18 div containers, one for each note. After doing so, our HTML page will look like this.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><br>        Multi-touch tone Generator<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>apple-mobile-web-app-capable<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>yes<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>        <span class="token selector">body</span> <span class="token punctuation">{</span><br>            <span class="token property">-webkit-user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>            <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>            <span class="token property">margin-right</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span><br>            <span class="token property">touch-action</span><span class="token punctuation">:</span> pan-y<span class="token punctuation">;</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token selector">.notecontainer</span> <span class="token punctuation">{</span><br>            <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>            <span class="token property">flex-direction</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span><br>            <span class="token property">justify-content</span><span class="token punctuation">:</span> space-evenly<span class="token punctuation">;</span><br>            <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token selector">.notebox</span> <span class="token punctuation">{</span><br>            <span class="token property">width</span><span class="token punctuation">:</span> 15%<span class="token punctuation">;</span><br>            <span class="token property">flex-grow</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br>            <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span><br>            <span class="token property">border</span><span class="token punctuation">:</span> 1px solid white<span class="token punctuation">;</span><br>            <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br>            <span class="token property">font-size</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token selector">#note-0</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #00FEFF<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-1</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #00C8FF<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-2</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #009BDF<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-3</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #005BFF<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-4</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #0024FF<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-5</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #001495<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br><br>        <span class="token selector">#note-6</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #2a2d34<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-7</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #00dc0b<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-8</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #f26430<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-9</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #6761a8<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-10</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> #009b72<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token selector">#note-11</span> <span class="token punctuation">{</span><br>            <span class="token property">background-color</span><span class="token punctuation">:</span> silver<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1, maximum-scale=1,user-scalable=no<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notecontainer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>note-0<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-6<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-7<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-9<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-10<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-11<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-12<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-13<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-14<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-15<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-16<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>notebox<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>note-17<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p>Next, let's create a script tag and create a variable that stores the frequency values of every musical note. We'll need this later. Add this script tag inside your <code>&lt;body&gt;</code> tags.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>    <span class="token keyword">var</span> notes<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">C0</span><span class="token operator">:</span><span class="token number">16.35</span><span class="token punctuation">,</span><span class="token string">"C#0"</span><span class="token operator">:</span><span class="token number">17.32</span><span class="token punctuation">,</span>Db0<span class="token operator">:</span><span class="token number">17.32</span><span class="token punctuation">,</span><span class="token constant">D0</span><span class="token operator">:</span><span class="token number">18.35</span><span class="token punctuation">,</span><span class="token string">"D#0"</span><span class="token operator">:</span><span class="token number">19.45</span><span class="token punctuation">,</span>Eb0<span class="token operator">:</span><span class="token number">19.45</span><span class="token punctuation">,</span><span class="token constant">E0</span><span class="token operator">:</span><span class="token number">20.6</span><span class="token punctuation">,</span><span class="token constant">F0</span><span class="token operator">:</span><span class="token number">21.83</span><span class="token punctuation">,</span><span class="token string">"F#0"</span><span class="token operator">:</span><span class="token number">23.12</span><span class="token punctuation">,</span>Gb0<span class="token operator">:</span><span class="token number">23.12</span><span class="token punctuation">,</span><span class="token constant">G0</span><span class="token operator">:</span><span class="token number">24.5</span><span class="token punctuation">,</span><span class="token string">"G#0"</span><span class="token operator">:</span><span class="token number">25.96</span><span class="token punctuation">,</span>Ab0<span class="token operator">:</span><span class="token number">25.96</span><span class="token punctuation">,</span><span class="token constant">A0</span><span class="token operator">:</span><span class="token number">27.5</span><span class="token punctuation">,</span><span class="token string">"A#0"</span><span class="token operator">:</span><span class="token number">29.14</span><span class="token punctuation">,</span>Bb0<span class="token operator">:</span><span class="token number">29.14</span><span class="token punctuation">,</span><span class="token constant">B0</span><span class="token operator">:</span><span class="token number">30.87</span><span class="token punctuation">,</span><span class="token constant">C1</span><span class="token operator">:</span><span class="token number">32.7</span><span class="token punctuation">,</span><span class="token string">"C#1"</span><span class="token operator">:</span><span class="token number">34.65</span><span class="token punctuation">,</span>Db1<span class="token operator">:</span><span class="token number">34.65</span><span class="token punctuation">,</span><span class="token constant">D1</span><span class="token operator">:</span><span class="token number">36.71</span><span class="token punctuation">,</span><span class="token string">"D#1"</span><span class="token operator">:</span><span class="token number">38.89</span><span class="token punctuation">,</span>Eb1<span class="token operator">:</span><span class="token number">38.89</span><span class="token punctuation">,</span><span class="token constant">E1</span><span class="token operator">:</span><span class="token number">41.2</span><span class="token punctuation">,</span><span class="token constant">F1</span><span class="token operator">:</span><span class="token number">43.65</span><span class="token punctuation">,</span><span class="token string">"F#1"</span><span class="token operator">:</span><span class="token number">46.25</span><span class="token punctuation">,</span>Gb1<span class="token operator">:</span><span class="token number">46.25</span><span class="token punctuation">,</span><span class="token constant">G1</span><span class="token operator">:</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token string">"G#1"</span><span class="token operator">:</span><span class="token number">51.91</span><span class="token punctuation">,</span>Ab1<span class="token operator">:</span><span class="token number">51.91</span><span class="token punctuation">,</span><span class="token constant">A1</span><span class="token operator">:</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token string">"A#1"</span><span class="token operator">:</span><span class="token number">58.27</span><span class="token punctuation">,</span>Bb1<span class="token operator">:</span><span class="token number">58.27</span><span class="token punctuation">,</span><span class="token constant">B1</span><span class="token operator">:</span><span class="token number">61.74</span><span class="token punctuation">,</span><span class="token constant">C2</span><span class="token operator">:</span><span class="token number">65.41</span><span class="token punctuation">,</span><span class="token string">"C#2"</span><span class="token operator">:</span><span class="token number">69.3</span><span class="token punctuation">,</span>Db2<span class="token operator">:</span><span class="token number">69.3</span><span class="token punctuation">,</span><span class="token constant">D2</span><span class="token operator">:</span><span class="token number">73.42</span><span class="token punctuation">,</span><span class="token string">"D#2"</span><span class="token operator">:</span><span class="token number">77.78</span><span class="token punctuation">,</span>Eb2<span class="token operator">:</span><span class="token number">77.78</span><span class="token punctuation">,</span><span class="token constant">E2</span><span class="token operator">:</span><span class="token number">82.41</span><span class="token punctuation">,</span><span class="token constant">F2</span><span class="token operator">:</span><span class="token number">87.31</span><span class="token punctuation">,</span><span class="token string">"F#2"</span><span class="token operator">:</span><span class="token number">92.5</span><span class="token punctuation">,</span>Gb2<span class="token operator">:</span><span class="token number">92.5</span><span class="token punctuation">,</span><span class="token constant">G2</span><span class="token operator">:</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token string">"G#2"</span><span class="token operator">:</span><span class="token number">103.83</span><span class="token punctuation">,</span>Ab2<span class="token operator">:</span><span class="token number">103.83</span><span class="token punctuation">,</span><span class="token constant">A2</span><span class="token operator">:</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token string">"A#2"</span><span class="token operator">:</span><span class="token number">116.54</span><span class="token punctuation">,</span>Bb2<span class="token operator">:</span><span class="token number">116.54</span><span class="token punctuation">,</span><span class="token constant">B2</span><span class="token operator">:</span><span class="token number">123.47</span><span class="token punctuation">,</span><span class="token constant">C3</span><span class="token operator">:</span><span class="token number">130.81</span><span class="token punctuation">,</span><span class="token string">"C#3"</span><span class="token operator">:</span><span class="token number">138.59</span><span class="token punctuation">,</span>Db3<span class="token operator">:</span><span class="token number">138.59</span><span class="token punctuation">,</span><span class="token constant">D3</span><span class="token operator">:</span><span class="token number">146.83</span><span class="token punctuation">,</span><span class="token string">"D#3"</span><span class="token operator">:</span><span class="token number">155.56</span><span class="token punctuation">,</span>Eb3<span class="token operator">:</span><span class="token number">155.56</span><span class="token punctuation">,</span><span class="token constant">E3</span><span class="token operator">:</span><span class="token number">164.81</span><span class="token punctuation">,</span><span class="token constant">F3</span><span class="token operator">:</span><span class="token number">174.61</span><span class="token punctuation">,</span><span class="token string">"F#3"</span><span class="token operator">:</span><span class="token number">185</span><span class="token punctuation">,</span>Gb3<span class="token operator">:</span><span class="token number">185</span><span class="token punctuation">,</span><span class="token constant">G3</span><span class="token operator">:</span><span class="token number">196</span><span class="token punctuation">,</span><span class="token string">"G#3"</span><span class="token operator">:</span><span class="token number">207.65</span><span class="token punctuation">,</span>Ab3<span class="token operator">:</span><span class="token number">207.65</span><span class="token punctuation">,</span><span class="token constant">A3</span><span class="token operator">:</span><span class="token number">220</span><span class="token punctuation">,</span><span class="token string">"A#3"</span><span class="token operator">:</span><span class="token number">233.08</span><span class="token punctuation">,</span>Bb3<span class="token operator">:</span><span class="token number">233.08</span><span class="token punctuation">,</span><span class="token constant">B3</span><span class="token operator">:</span><span class="token number">246.94</span><span class="token punctuation">,</span><span class="token constant">C4</span><span class="token operator">:</span><span class="token number">261.63</span><span class="token punctuation">,</span><span class="token string">"C#4"</span><span class="token operator">:</span><span class="token number">277.18</span><span class="token punctuation">,</span>Db4<span class="token operator">:</span><span class="token number">277.18</span><span class="token punctuation">,</span><span class="token constant">D4</span><span class="token operator">:</span><span class="token number">293.66</span><span class="token punctuation">,</span><span class="token string">"D#4"</span><span class="token operator">:</span><span class="token number">311.13</span><span class="token punctuation">,</span>Eb4<span class="token operator">:</span><span class="token number">311.13</span><span class="token punctuation">,</span><span class="token constant">E4</span><span class="token operator">:</span><span class="token number">329.63</span><span class="token punctuation">,</span><span class="token constant">F4</span><span class="token operator">:</span><span class="token number">349.23</span><span class="token punctuation">,</span><span class="token string">"F#4"</span><span class="token operator">:</span><span class="token number">369.99</span><span class="token punctuation">,</span>Gb4<span class="token operator">:</span><span class="token number">369.99</span><span class="token punctuation">,</span><span class="token constant">G4</span><span class="token operator">:</span><span class="token number">392</span><span class="token punctuation">,</span><span class="token string">"G#4"</span><span class="token operator">:</span><span class="token number">415.3</span><span class="token punctuation">,</span>Ab4<span class="token operator">:</span><span class="token number">415.3</span><span class="token punctuation">,</span><span class="token constant">A4</span><span class="token operator">:</span><span class="token number">440</span><span class="token punctuation">,</span><span class="token string">"A#4"</span><span class="token operator">:</span><span class="token number">466.16</span><span class="token punctuation">,</span>Bb4<span class="token operator">:</span><span class="token number">466.16</span><span class="token punctuation">,</span><span class="token constant">B4</span><span class="token operator">:</span><span class="token number">493.88</span><span class="token punctuation">,</span><span class="token constant">C5</span><span class="token operator">:</span><span class="token number">523.25</span><span class="token punctuation">,</span><span class="token string">"C#5"</span><span class="token operator">:</span><span class="token number">554.37</span><span class="token punctuation">,</span>Db5<span class="token operator">:</span><span class="token number">554.37</span><span class="token punctuation">,</span><span class="token constant">D5</span><span class="token operator">:</span><span class="token number">587.33</span><span class="token punctuation">,</span><span class="token string">"D#5"</span><span class="token operator">:</span><span class="token number">622.25</span><span class="token punctuation">,</span>Eb5<span class="token operator">:</span><span class="token number">622.25</span><span class="token punctuation">,</span><span class="token constant">E5</span><span class="token operator">:</span><span class="token number">659.26</span><span class="token punctuation">,</span><span class="token constant">F5</span><span class="token operator">:</span><span class="token number">698.46</span><span class="token punctuation">,</span><span class="token string">"F#5"</span><span class="token operator">:</span><span class="token number">739.99</span><span class="token punctuation">,</span>Gb5<span class="token operator">:</span><span class="token number">739.99</span><span class="token punctuation">,</span><span class="token constant">G5</span><span class="token operator">:</span><span class="token number">783.99</span><span class="token punctuation">,</span><span class="token string">"G#5"</span><span class="token operator">:</span><span class="token number">830.61</span><span class="token punctuation">,</span>Ab5<span class="token operator">:</span><span class="token number">830.61</span><span class="token punctuation">,</span><span class="token constant">A5</span><span class="token operator">:</span><span class="token number">880</span><span class="token punctuation">,</span><span class="token string">"A#5"</span><span class="token operator">:</span><span class="token number">932.33</span><span class="token punctuation">,</span>Bb5<span class="token operator">:</span><span class="token number">932.33</span><span class="token punctuation">,</span><span class="token constant">B5</span><span class="token operator">:</span><span class="token number">987.77</span><span class="token punctuation">,</span><span class="token constant">C6</span><span class="token operator">:</span><span class="token number">1046.5</span><span class="token punctuation">,</span><span class="token string">"C#6"</span><span class="token operator">:</span><span class="token number">1108.73</span><span class="token punctuation">,</span>Db6<span class="token operator">:</span><span class="token number">1108.73</span><span class="token punctuation">,</span><span class="token constant">D6</span><span class="token operator">:</span><span class="token number">1174.66</span><span class="token punctuation">,</span><span class="token string">"D#6"</span><span class="token operator">:</span><span class="token number">1244.51</span><span class="token punctuation">,</span>Eb6<span class="token operator">:</span><span class="token number">1244.51</span><span class="token punctuation">,</span><span class="token constant">E6</span><span class="token operator">:</span><span class="token number">1318.51</span><span class="token punctuation">,</span><span class="token constant">F6</span><span class="token operator">:</span><span class="token number">1396.91</span><span class="token punctuation">,</span><span class="token string">"F#6"</span><span class="token operator">:</span><span class="token number">1479.98</span><span class="token punctuation">,</span>Gb6<span class="token operator">:</span><span class="token number">1479.98</span><span class="token punctuation">,</span><span class="token constant">G6</span><span class="token operator">:</span><span class="token number">1567.98</span><span class="token punctuation">,</span><span class="token string">"G#6"</span><span class="token operator">:</span><span class="token number">1661.22</span><span class="token punctuation">,</span>Ab6<span class="token operator">:</span><span class="token number">1661.22</span><span class="token punctuation">,</span><span class="token constant">A6</span><span class="token operator">:</span><span class="token number">1760</span><span class="token punctuation">,</span><span class="token string">"A#6"</span><span class="token operator">:</span><span class="token number">1864.66</span><span class="token punctuation">,</span>Bb6<span class="token operator">:</span><span class="token number">1864.66</span><span class="token punctuation">,</span><span class="token constant">B6</span><span class="token operator">:</span><span class="token number">1975.53</span><span class="token punctuation">,</span><span class="token constant">C7</span><span class="token operator">:</span><span class="token number">2093</span><span class="token punctuation">,</span><span class="token string">"C#7"</span><span class="token operator">:</span><span class="token number">2217.46</span><span class="token punctuation">,</span>Db7<span class="token operator">:</span><span class="token number">2217.46</span><span class="token punctuation">,</span><span class="token constant">D7</span><span class="token operator">:</span><span class="token number">2349.32</span><span class="token punctuation">,</span><span class="token string">"D#7"</span><span class="token operator">:</span><span class="token number">2489.02</span><span class="token punctuation">,</span>Eb7<span class="token operator">:</span><span class="token number">2489.02</span><span class="token punctuation">,</span><span class="token constant">E7</span><span class="token operator">:</span><span class="token number">2637.02</span><span class="token punctuation">,</span><span class="token constant">F7</span><span class="token operator">:</span><span class="token number">2793.83</span><span class="token punctuation">,</span><span class="token string">"F#7"</span><span class="token operator">:</span><span class="token number">2959.96</span><span class="token punctuation">,</span>Gb7<span class="token operator">:</span><span class="token number">2959.96</span><span class="token punctuation">,</span><span class="token constant">G7</span><span class="token operator">:</span><span class="token number">3135.96</span><span class="token punctuation">,</span><span class="token string">"G#7"</span><span class="token operator">:</span><span class="token number">3322.44</span><span class="token punctuation">,</span>Ab7<span class="token operator">:</span><span class="token number">3322.44</span><span class="token punctuation">,</span><span class="token constant">A7</span><span class="token operator">:</span><span class="token number">3520</span><span class="token punctuation">,</span><span class="token string">"A#7"</span><span class="token operator">:</span><span class="token number">3729.31</span><span class="token punctuation">,</span>Bb7<span class="token operator">:</span><span class="token number">3729.31</span><span class="token punctuation">,</span><span class="token constant">B7</span><span class="token operator">:</span><span class="token number">3951.07</span><span class="token punctuation">,</span><span class="token constant">C8</span><span class="token operator">:</span><span class="token number">4186.01</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h3 id="creating-audio-devices">Creating audio devices <a class="direct-link" href="#creating-audio-devices">#</a></h3>
<p>Next, let's use the new HTML5 AudioContext API to create wave generators. We'll need to support multiple notes at once, so we need a system that creates multiple oscillator objects. Let's create a reference an AudioContext and an oscillators object to store our frequency generators:</p>
<pre class="language-javascript"><code class="language-javascript">window<span class="token punctuation">.</span>AudioContext <span class="token operator">=</span> window<span class="token punctuation">.</span>AudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitAudioContext<span class="token punctuation">;</span><br><span class="token keyword">var</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> oscillators <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h3 id="generating-a-tone">Generating a tone <a class="direct-link" href="#generating-a-tone">#</a></h3>
<p>Now we need a method which can be passed a note ID and generate a tone. Each element of our <code>oscillators</code> object must contain two variables: the oscillator itself and a gain manager which controls the volume. The code below does both.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">startNote</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> frq <span class="token operator">=</span> notes<span class="token punctuation">[</span>config<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token keyword">in</span> oscillators<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// we already have an oscillator for this note id</span><br>        <span class="token comment">// store a reference to in in o and g</span><br>        o <span class="token operator">=</span> oscillators<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        g <span class="token operator">=</span> oscillators<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token comment">// we need to create a new oscillator</span><br>        <span class="token keyword">let</span> _o <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createOscillator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        _o<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'sawtooth'</span><span class="token punctuation">;</span><br>        <span class="token comment">// and gain manager</span><br>        <span class="token keyword">let</span> _g <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createGain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        _g<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>        _o<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>_g<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        _g<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// let's store our newly created oscillator in the oscillators object</span><br>        <span class="token comment">// the "false" means this oscillator has not been started.</span><br>        <span class="token comment">/* this is necessary because we cannot start our oscillators until the user touches<br>        something on the page. This restriction is imposed by mobile browers to prevent badly<br>        behaved pages from making noise without permission */</span><br>        oscillators<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>_o<span class="token punctuation">,</span> _g<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        o <span class="token operator">=</span> _o<span class="token punctuation">;</span><br>        g <span class="token operator">=</span> _g<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    o<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'sawtooth'</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>frq<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oscillators<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            o<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            oscillators<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        o<span class="token punctuation">.</span>frequency<span class="token punctuation">.</span>value <span class="token operator">=</span> frq<span class="token punctuation">;</span><br>        g<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The function to stop a note is much simpler:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">stopNote</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    oscillators<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="creating-and-sorting-the-tone-palette">Creating and sorting the tone palette <a class="direct-link" href="#creating-and-sorting-the-tone-palette">#</a></h3>
<p>Our application accepts configuration from an array of strings in the standard note-octave format. You could build a UI to make this configurable by the user, but that will not be covered in this tutorial. Here's an example config array:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'F#2'</span><span class="token punctuation">,</span> <span class="token string">'G#2'</span><span class="token punctuation">,</span> <span class="token string">'F#3'</span><span class="token punctuation">,</span> <span class="token string">'A2'</span><span class="token punctuation">,</span> <span class="token string">'A3'</span><span class="token punctuation">,</span> <span class="token string">'C#4'</span><span class="token punctuation">,</span> <span class="token string">'B3'</span><span class="token punctuation">,</span> <span class="token string">'G#3'</span><span class="token punctuation">,</span> <span class="token string">'C#3'</span><span class="token punctuation">,</span> <span class="token string">'B2'</span><span class="token punctuation">,</span> <span class="token string">'E3'</span><span class="token punctuation">,</span> <span class="token string">'D3'</span><span class="token punctuation">,</span> <span class="token string">'D#3'</span><span class="token punctuation">,</span> <span class="token string">'F#4'</span><span class="token punctuation">,</span> <span class="token string">'D#4'</span><span class="token punctuation">,</span> <span class="token string">'B4'</span><span class="token punctuation">,</span> <span class="token string">'A4'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>We want our notes to be ordered correctly, but you probably noticed that <strong>this array is not correctly sorted by tone.</strong> So, let's write a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">comparison function</a> to sort these strings correctly by pitch.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sortNotes</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// the numeric value of the note in the octave, 0-6</span><br>    <span class="token keyword">let</span> a_note <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> b_note <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token comment">// the numeric value of the octave</span><br>    <span class="token keyword">let</span> a_octave <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> b_octave <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token comment">// whether the note is sharp or flat, -1 is flat, +1 is sharp</span><br>    <span class="token keyword">let</span> a_sharp_flat <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> b_sharp_flat <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Check for a sharp/flat note and record.</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            a_sharp_flat <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            a_sharp_flat <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            b_sharp_flat <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            b_sharp_flat <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    a_note <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    b_note <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    a_octave <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><br>    b_octave <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// if the octaves are different, we can immediately return</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a_octave <span class="token operator">></span> b_octave<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a_octave <span class="token operator">&lt;</span> b_octave<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// we must be in the same octave, compare notes</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a_note <span class="token operator">></span> b_note<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a_note <span class="token operator">&lt;</span> b_note<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// check sharp/flat</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a_sharp_flat <span class="token operator">></span> b_sharp_flat<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a_sharp_flat <span class="token operator">&lt;</span> b_sharp_flat<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>That's a really big function, but at least it's readable and intuitive. Just for fun, let's <a href="https://codegolf.stackexchange.com/">golf</a> this function:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sortNotes</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    o <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"E"</span><span class="token punctuation">,</span> <span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"G"</span><span class="token punctuation">,</span> <span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token function-variable function">z</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token parameter">g</span> <span class="token operator">=></span> o<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span> l <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span>n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> s <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token function">z</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">z</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token function">z</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">z</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> s <span class="token operator">&lt;</span> l <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> l <span class="token operator">&lt;</span> s <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span><br>        <span class="token operator">!</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">!</span><span class="token punctuation">(</span>n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><br><span class="token punctuation">}</span></code></pre>
<p>That's better! This is the exact same approach; However, it takes advantage of string comparison (<code>!('#' &gt; 'b') == true</code>) and the ternary operator. It's unfortunately much less readable. ðŸ˜›</p>
<h3 id="hooking-our-interface-up">Hooking our interface up <a class="direct-link" href="#hooking-our-interface-up">#</a></h3>
<p>Now, let's create click handlers for our UI. Since they all have the class <code>notebox</code> we can loop over them and add the event listeners:</p>
<pre class="language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.notebox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    f<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> note <span class="token operator">=</span> config<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span><br>        e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> note<span class="token punctuation">;</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>note<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">'white'</span><span class="token punctuation">;</span><br>        <span class="token function">startNote</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.notebox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    f<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchend'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>        <span class="token function">stopNote</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>You can try the note test interface <a href="https://jackson.sh/misc/2021-04-multitouch-keyboard">here</a>, it only works on mobile devices due to its usage of JavaScript events <code>touchstart</code> and <code>touchend</code>.</p>
<p>To test our tone generation and interface, I recorded this video using the talkbox manually without motion controls. Here's me playing <em>Stronger</em> by Daft Punk very badly:</p>
<video controls height="300">
    <source src="/img/2021-04-11.mp4" type="video/mp4">
</video>
<h3 id="capturing-input-from-the-joycons">Capturing input from the Joycons <a class="direct-link" href="#capturing-input-from-the-joycons">#</a></h3>
<p>This was by far the most time consuming part of this project and involved using and compiling a variety of C++ libraries. Prior to moving on, you'll need to install <a href="https://cmake.org/">CMake</a>, <a href="https://github.com/JibbSmart/JoyShockLibrary">JoyShockLib</a>, and the <a href="https://github.com/signal11/hidapi">HIDAPI</a> on your system.</p>
<p>Our implementation looks something like this:</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;chrono></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mutex></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><br><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"JoyShockLibrary.h"</span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"SDL2/SDL.h"</span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"hidapi.h"</span></span><br><br><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">;</span><br><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span><br><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><br><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>mutex<span class="token punctuation">;</span><br><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">;</span><br><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LEFT_JOYCON</span> <span class="token expression"><span class="token number">1</span></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RIGHT_JOYCON</span> <span class="token expression"><span class="token number">2</span></span></span><br><br><span class="token keyword">void</span> <span class="token function">connectDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">int</span> numConnected <span class="token operator">=</span> <span class="token function">JslConnectDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">JslDisconnectAndDisposeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">imu_frame_t</span> <span class="token punctuation">{</span><br>    <span class="token comment">// local acceleration without gravity</span><br>    <span class="token keyword">float</span> accelX<span class="token punctuation">;</span><br>    <span class="token keyword">float</span> accelY<span class="token punctuation">;</span><br>    <span class="token keyword">float</span> accelZ<span class="token punctuation">;</span><br>    <span class="token comment">// gravity vector</span><br>    <span class="token keyword">float</span> gravX<span class="token punctuation">;</span><br>    <span class="token keyword">float</span> gravY<span class="token punctuation">;</span><br>    <span class="token keyword">float</span> gravZ<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">executeNoteChange</span><span class="token punctuation">(</span>JOY_SHOCK_STATE state<span class="token punctuation">,</span> <span class="token keyword">int</span> handId<span class="token punctuation">)</span> <span class="token punctuation">{</span><br><br><span class="token punctuation">}</span><br><br><span class="token comment">// This function gets run every time we get a state update from the program.</span><br><span class="token keyword">void</span> <span class="token function">joyShockPollCallback</span><span class="token punctuation">(</span><span class="token keyword">int</span> jcHandle<span class="token punctuation">,</span> JOY_SHOCK_STATE state<span class="token punctuation">,</span> JOY_SHOCK_STATE lastState<span class="token punctuation">,</span> IMU_STATE imuState<span class="token punctuation">,</span><br>                          IMU_STATE lastImuState<span class="token punctuation">,</span> <span class="token keyword">float</span> deltaTime<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    MOTION_STATE motion <span class="token operator">=</span> <span class="token function">JslGetMotionState</span><span class="token punctuation">(</span>jcHandle<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">int</span> hand <span class="token operator">=</span> <span class="token function">JslGetControllerType</span><span class="token punctuation">(</span>jcHandle<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hand <span class="token operator">==</span> LEFT_JOYCON<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"x: "</span> <span class="token operator">&lt;&lt;</span> motion<span class="token punctuation">.</span>gravX <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><br>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"y: "</span> <span class="token operator">&lt;&lt;</span> motion<span class="token punctuation">.</span>gravY <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><br>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"z: "</span> <span class="token operator">&lt;&lt;</span> motion<span class="token punctuation">.</span>gravZ <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hand <span class="token operator">==</span> RIGHT_JOYCON<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"           x: "</span> <span class="token operator">&lt;&lt;</span> motion<span class="token punctuation">.</span>gravX <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><br>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"           y: "</span> <span class="token operator">&lt;&lt;</span> motion<span class="token punctuation">.</span>gravY <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><br>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"           z: "</span> <span class="token operator">&lt;&lt;</span> motion<span class="token punctuation">.</span>gravZ <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>deltaTime <span class="token operator">></span> <span class="token number">0.06</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// lag warning</span><br>        <span class="token keyword">float</span> lagAmount <span class="token operator">=</span> <span class="token punctuation">(</span>deltaTime <span class="token operator">/</span> <span class="token number">0.015</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span><br>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"WARNING: deltaTime of "</span> <span class="token operator">&lt;&lt;</span> deltaTime <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" is greater than 30ms on controller "</span><br>             <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>hand <span class="token operator">==</span> LEFT_JOYCON <span class="token operator">?</span> <span class="token string">"LEFT_JOYCON"</span> <span class="token operator">:</span> <span class="token string">"RIGHT_JOYCON"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" ("</span> <span class="token operator">&lt;&lt;</span> lagAmount <span class="token operator">&lt;&lt;</span> <span class="token string">"% lag)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>motion<span class="token punctuation">.</span>accelZ <span class="token operator">></span> <span class="token number">.5</span> <span class="token operator">||</span> motion<span class="token punctuation">.</span>accelY <span class="token operator">></span> <span class="token number">.5</span>  <span class="token operator">||</span> motion<span class="token punctuation">.</span>accelX <span class="token operator">></span> <span class="token number">.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// a large change in motion has occured, check the buffers to figure out what it is and forward the information.</span><br>        <span class="token function">executeNoteChange</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> hand<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"hi!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><br><br>    <span class="token function">connectDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">JslSetCallback</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>joyShockPollCallback<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">bool</span> quit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    SDL_Event event<span class="token punctuation">;</span><br>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>quit<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">SDL_PollEvent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token comment">// User requests quit</span><br>            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> SDL_QUIT<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                quit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Quit SDL subsystems</span><br>    <span class="token function">SDL_Quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre>
<h3 id="processing-gestures-for-pitch-control">Processing gestures for pitch control <a class="direct-link" href="#processing-gestures-for-pitch-control">#</a></h3>
<p>In order to determine what gesture the user is making and send that information to the tone generator, we'll need to add some more code. First, you'll need to install and create the associated boilerplate code for <a href="https://github.com/Theldus/wsServer">wsServer</a> and add something resembling this to your <code>executeNoteChange</code> function.</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span>handId <span class="token operator">==</span> LEFT_JOYCON<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// go up a note</span><br>    <span class="token function">ws_sendframe_txt</span><span class="token punctuation">(</span>websocketClient<span class="token punctuation">,</span> <span class="token string">"down"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>handId <span class="token operator">==</span> RIGHT_JOYCON<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// go down a note</span><br>    <span class="token function">ws_sendframe_txt</span><span class="token punctuation">(</span>websocketClient<span class="token punctuation">,</span> <span class="token string">"up"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="demo">Demo <a class="direct-link" href="#demo">#</a></h2>
<p>This proof-of-concept demonstrates the ability for a user to control their pitch by gesturing with Joycons. The user can gesture to the side with either hand to turn the tone on and off. Gesturing upwards with the right hand raises the pitch to the next configured note, while gesturing upwards with the left hand raises the pitch two configured notes up.</p>
<video controls height="300">
    <source src="/img/2021-04-12.mp4" type="video/mp4">
</video>


</div>

<hr>
<ul>
</ul>


</main>

<footer></footer>

<!-- Current page: /posts/2021-04-wearable-talkbox-with-gesture-controls/ -->
</body>
</html>
